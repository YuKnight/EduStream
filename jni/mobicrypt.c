#include <stdio.h>
#include <memory.h>
#include "aes_lcl.h"


int mobi_cryptWithKey(char *plaintext, unsigned int len, char *ctext, unsigned char *key_in) {

    unsigned int key_schedule[60];
    unsigned char iv[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,
                            0x0c, 0x0d, 0x0e, 0x0f};

    /* unsigned char key_new[32] = {0x74, 0x68, 0x69, 0x73, 0x69, 0x73, 0x79,
                                  0x6f, 0x75, 0x72, 0x70, 0x61, 0x73, 0x73,
                                  0x77, 0x6f, 0x72, 0x64, 0x66, 0x6f, 0x72,
                                  0x61, 0x65, 0x73, 0x65, 0x6e, 0x63, 0x72,
                                  0x79, 0x70, 0x74, 0x6e};

     unsigned char key_from[32] = {0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b,
                                   0x61, 0x08, 0xd7, 0x2d, 0x98, 0x10, 0xa3,
                                   0x77, 0x6f, 0x72, 0x64, 0x66, 0x6f, 0x72,
                                   0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b,
                                   0x09, 0x14, 0xdf, 0xf4};

     unsigned char key[32] = {0x60, 0x3d, 0xeb, 0x10, 0x15, 0xca, 0x71,
                              0xbe, 0x2b, 0x73, 0xae, 0xf0, 0x85, 0x7d,
                              0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b,
                              0x61, 0x08, 0xd7, 0x2d, 0x98, 0x10, 0xa3,
                              0x09, 0x14, 0xdf, 0xf4};*/
    unsigned char lclCtext[128];
    int i = 0;
    memset(lclCtext, 0x00, 128);

    memset(key_schedule, 0x00, 60);

    aes_key_setup(key_in, &key_schedule[0], 256);
    aes_encrypt_cbc(plaintext, 64, ctext, key_schedule, 256, iv);
   /* for (i = 0; lclCtext[i] != 0x00; i++) {
        ctext[i] = lclCtext[i];
    }
    ctext[i] = '\0';*/
    return 0;

}


int mobi_decrptWithKey(char *plaintext, unsigned int len, char *rtext, unsigned char *key_in) {

    /* unsigned char key_new[32] = {0x74, 0x68, 0x69, 0x73, 0x69, 0x73, 0x79,
                                  0x6f, 0x75, 0x72, 0x70, 0x61, 0x73, 0x73,
                                  0x77, 0x6f, 0x72, 0x64, 0x66, 0x6f, 0x72,
                                  0x61, 0x65, 0x73, 0x65, 0x6e, 0x63, 0x72,
                                  0x79, 0x70, 0x74, 0x6e};


     unsigned char key[32] = {0x60, 0x3d, 0xeb, 0x10, 0x15, 0xca, 0x71, 0xbe, 0x2b, 0x73, 0xae, 0xf0,
                              0x85, 0x7d, 0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b, 0x61, 0x08, 0xd7,
                              0x2d, 0x98, 0x10, 0xa3, 0x09, 0x14, 0xdf, 0xf4};*/

    unsigned int key_schedule[60];
    unsigned char iv[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,
                            0x0c, 0x0d, 0x0e, 0x0f};

    unsigned char lclCtext[128];
    int i = 0;
    memset(lclCtext, 0x00, 128);

    memset(key_schedule, 0x00, 60);
    aes_key_setup(key_in, key_schedule, 256);
    aes_decrypt_cbc(plaintext, 64, rtext, key_schedule, 256, iv);


    return 0;
}


int mobi_crypt(char *plaintext, unsigned int len, char *ctext) {

    unsigned int key_schedule[60];
    unsigned char key[32] = {0x60, 0x3d, 0xeb, 0x10, 0x15, 0xca, 0x71, 0xbe, 0x2b, 0x73, 0xae, 0xf0,
                             0x85, 0x7d, 0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b, 0x61, 0x08, 0xd7,
                             0x2d, 0x98, 0x10, 0xa3, 0x09, 0x14, 0xdf, 0xf4};
    unsigned char iv[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,
                            0x0c, 0x0d, 0x0e, 0x0f};

    unsigned char lclCtext[128];
    int i = 0;
    memset(lclCtext, 0x00, 128);

    memset(key_schedule, 0x00, 60);

    aes_key_setup(key, &key_schedule[0], 256);
    aes_encrypt_cbc(plaintext, 64, lclCtext, key_schedule, 256, iv);
    for (i = 0; lclCtext[i] != 0x00; i++) {
        ctext[i] = lclCtext[i];
    }
    ctext[i] = '\0';
    return 0;
}


int mobi_decrpt(char *plaintext, unsigned int len, char *ctext) {

    unsigned int key_schedule[60];
    unsigned char key[32] = {0x60, 0x3d, 0xeb, 0x10, 0x15, 0xca, 0x71, 0xbe, 0x2b, 0x73, 0xae, 0xf0,
                             0x85, 0x7d, 0x77, 0x81, 0x1f, 0x35, 0x2c, 0x07, 0x3b, 0x61, 0x08, 0xd7,
                             0x2d, 0x98, 0x10, 0xa3, 0x09, 0x14, 0xdf, 0xf4};
    unsigned char iv[16] = {0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b,
                            0x0c, 0x0d, 0x0e, 0x0f};

    memset(key_schedule, 0x00, 60);
    aes_key_setup(key, key_schedule, 256);
    aes_decrypt_cbc(plaintext, 64, ctext, key_schedule, 256, iv);
    return 0;
}





